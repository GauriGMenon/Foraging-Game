<!-- <form method="POST" action="https://jz6ark0jjf.execute-api.ap-south-1.amazonaws.com/default/mind-matters-forage-data">  -->


<!-- mturk hit below --> 
<!-- ***************************************************************************************************************************************** -->

<!-- jquery import -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<!-- CSS styling -->
<style>
body {
    height: 100%;
    width: 100%;
    padding: 0;
    margin: 0;
    background-color:	lemonchiffon; 
}

.startDiv {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-auto-rows: minmax(10px, auto);
    grid-gap: 5px;
    margin: 0 auto;
    font-size: 18px;
    font-family: "Comic sans MS";
    padding: 20px;
    width: 512px;
    background-color: palegoldenrod; 
}

#line0 {
    grid-row: 1 / 1;
    grid-column: 1 / 3;
    text-decoration: underline;
    font-size: 20px;
    text-align: center

}

#line1 {
    grid-row: 2 / 3;
    grid-column: 1 / 3
}

#line2 {
    padding: 5px;
    grid-row: 3 / 4;
    grid-column: 1 / 2;
}

#line3 {
    grid-row: 3 / 4;
    grid-column: 2 / 3;
}

#line4 {
    grid-row: 4 / 5;
    grid-column: 1 / 3;
    font-size: 14px;
}

#line100 {
    grid-row: 5 / 6;
    grid-column: 1 / 3;
}

#startDiv2, #startDiv3 {
    display: none;
}

#line5 {
    grid-row: 1 / 2;
    grid-column: 1 / 3;
}

#line6 {
    color: green;
    grid-row: 2 / 3;
    grid-column: 1 / 2;
}

#line7 {
    grid-row: 2 / 3;
    grid-column: 2 / 3;
}

#line8 {
    grid-row: 3 / 4;
    grid-column: 1 / 3;
}

#line9 {
    grid-row: 4 / 5;
    grid-column: 1 / 2;
}

#line10 {
    grid-row: 4 / 5;
    grid-column: 2 / 3;
}

#line10_5 {
    grid-row: 5 / 6;
    grid-column: 1 / 3;
}

#line11 {
    grid-row: 6 / 7;
    grid-column: 1 / 3;
}

#line12 {
    grid-row: 7 / 8;
    grid-column: 1 / 3;
}

#startTrial {
    grid-row: 11 / 12;
    grid-column: 1 / 3;
}

#trialDiv {
    position: absolute;
    height: 100%;
    width: 100%;
    display: none;
    font-size: 25px;
    font-family: "Comic Sans MS";
}


#road {
    position: absolute;
    height: 100%;
    width: 25%;
    left: 37.5%;
}

.lane {
    position: absolute;
    height: 100%;
    overflow: hidden;
    width: 12.5%;
    max-width: 150px;
}

#leftlane {
    right: 62.5%;
}

#rightlane {
    left: 62.5%;
}

.bush {
    position: absolute;
    width: 100%;
    max-width: 150px;
}

#explore {
    position: absolute;
    left: 63%;
    bottom: 7%;
    max-width: 150px;
}

#fixation {
    position: absolute;
    left: 0;
    right: 0;
    margin-left: auto;
    margin-right: auto;
    bottom: 7.5%;
    max-width: 135px;
}

#bushOutput {
    position: absolute;
    color: green;
    left: 15%;
    display: none;
}

#breakDiv {
    display: none;
    margin: 0 auto;
    font-size: 18px;
    font-family: "Comic Sans MS";
    padding: 20px;
    width: 300px;
}

#finishDiv {
    margin: 0 auto;
    font-size: 22px;
    font-family: "Comic Sans MS";
    padding: 18px;
    width: 500px;
    display: none;
    background-color: palegoldenrod; 
    text-align: center

}

#line13 {
    grid-row: 8 / 9;
    grid-column: 1 / 3;
    font-size: 22px;
    font-family: "Comic sans MS";
    background-color: palegoldenrod; 
}

#submitButton {
    position: absolute;
    left: 50%;
    display: none;
    background-color: palegoldenrod; 
    padding: 22px;
    width: 500px;
    text-align: center
}
</style>





<!-- html elements -->
<div id="startDiv1" class="startDiv">
    <p id="line0"><b>WELCOME TO THE EXPERIMENT!</b></p>
    <p id="line1"> Your goal is to <b>collect as many berries as you can</b> in the amount of time you are given.</p>
        <svg id="line2">
            <rect height=100px width=100px style="stroke:green;
                                                stroke-width: 4;
                                                fill:none;" />
            <rect height=100px width=100px style="fill:green;" />
        </svg>
        <div id="line3">First, hover over the center box until it fills up <b>completely</b>.<br/> (You may have to <b>wiggle your cursor</b> once for the center box to recognize your mouse.)</div>
        <p id="line4"><i>Note: All animations may not work properly on Firefox or Internet Explorer. If you are experiencing issues, try switching to another browser.</i></p>
        <p id="line100"> More the berries, more the monetary reward at the end of the study!</p>
        <br/>
        <p><a href="#" id="next1">Next</a></p>
</div>

<div id="startDiv2" class="startDiv">
    <p id="line5">Each time the box fills, you will either choose to <b>stay</b> at the bush you are at or <b>leave</b> the current bush and travel to a fresh bush.</p>
    <div id="line6">
        +1.83
        <img src="bush-md.png" width=100px>
    </div>
    <p id="line7">To <b>pick berries</b> from the current bush, hover your cursor over the bush next to the center box, after it fills up.
        The number of berries you pick at each attempt will be indicated next to the bush.</p>
    <p id="line8"><i>As you keep picking from the same bush repeatedly, the number of berries you pick at each attempt will go down as you will be <b>depleting</b> this bush.</i></p>
    <svg id="line9">
        <rect height=100px width=100px style="stroke:green;
                                 stroke-width: 6;
                                 fill:none;"/>
    </svg>
    <p id="line10">To <b>travel</b> to the next bush, mouse over the box on the opposite side of the bush, after the initial box fills up.</p>
    <p id="line10_5">You can choose to leave the current bush to travel to a fresh bush at any time. When you do that, you will need to wait while you travel to the next bush. However, once you arrive at the new bush, the amount of berries you pick at each harvest will reset to the initial value.</p>
    

    <p id="line11">You will play one session of the foraging game, which will consist of two blocks each. The environment will change between these blocks.</p>
    

    <p id="line12">There is an <b>unlimited number of bushes</b> in the environment, but a <b>finite amount of time</b> (3 minutes). Try to collect as many berries as you can; your bonus amount will be based on that!</p>
    

    <p><a href="#" id="next2">Next</a></p>
</div>

<div id="startDiv3" class="startDiv">
    <p>You may now watch this demonstration video.</p>

    <br/>
    <p>
        <video width="512" height="288" controls>
            <source src="Foraging Demo2.mp4" type="video/mp4">
        </video>
    </p>
    <br/>
    <p>You may now attempt a trial game before the experiment begins.</p>
    <br/>
    <p><a href="#" id="startTrial">Start Trial</a></p>
</div>

<div id="trialDiv">
    <svg id="road">
        <rect width=100% height=100% style="fill:#ffcc99" />
    </svg>

    <div id="leftlane" class="lane">
        <img id="bush0" class="bush" src="bush-md.png">
        <img id="bush2" class="bush" src="bush-md.png">
        <img id="bush4" class="bush" src="bush-md.png">
        <img id="bush6" class="bush" src="bush-md.png">
        <img id="bush8" class="bush" src="bush-md.png">
        <img id="bush10" class="bush" src="bush-md.png">
    </div>

    <div id="rightlane" class="lane">
        <img id="bush1" class="bush" src="bush-md.png">
        <img id="bush3" class="bush" src="bush-md.png">
        <img id="bush5" class="bush" src="bush-md.png">
        <img id="bush7" class="bush" src="bush-md.png">
        <img id="bush9" class="bush" src="bush-md.png">
        <img id="bush11" class="bush" src="bush-md.png">
    </div>

    <svg id="explore">
        <rect height=100% width=100% style="stroke:green;
                                 stroke-width: 6;
                                 fill:none;"/>
    </svg>

    <svg id="fixation">
        <rect id="fixationBorder" height=100% width=100% style="stroke:yellowgreen;
                                            stroke-width: 14;
                                            fill:none;" />
        <rect id="focus" height=0% width=100% style="fill:green;" />
    </svg>

    <p id="bushOutput"> 0.0 </p>
</div>

<!-- <div id="breakDiv">
    <p>Click "Next Round" below to start the next scenario.</p>
    <p>In this round, bushes are <b>farther apart</b>, so it will take longer to travel between them.</p>
    <p><a href="#" id="nextBlock">Next Round</a></p>
</div> -->

<div id="finishDiv">
    <p>Your time has expired.</p>
</div>

<div id="data">
    <input name="dummy" value=0 type="hidden">
</div>




<!-- javascript -->
<script>

// -- parameters --
var travelTime = 3000;   //time in between bushes in ms (2000)
var initBerries = 7;    //initial number of berries per bush
var rateOfDec = 1;    //rate at which berries deplete from bush
var randStdDev = 0.25;
//parameters used for the second block of time
var travelTime2 = 2000;
var initBerries2 = 13;
var rateOfDec2 = 3;
var randStdDev2 = 1;


var totalTime1 = 10;     //total time allotted for the trial 1 (in seconds)
var totalTime2 = 10;     //total time allotted for the trial 2 (in seconds)

var speed = 80;         // ms per 1% of the screen distance (inverse speed?) (120)
var fixationTime = 500; //time it takes to fill fixation square (ms)
var holdingTime = 1000; //time that result is displayed before user is released
// ----------------
var blockNumber = "b1";

// Code related to setup screen
$('#next1').click(function() {
    $('#startDiv1').hide();
    $('#startDiv2').css("display", "grid");
});

$('#next2').click(function() {
    $('#startDiv2').hide();
    $('#startDiv3').css("display", "grid");
});



// Function to add data in regular, non-ragged obs
function addObservation(eventLabel, totalTrialTime, reactionTime, decisionType, berryCount) {
    $('#data').append('<input name="' + eventLabel + '" type="hidden">');
    $('#data').append('<input name="' + eventLabel + '" class="totalTrialTime" value="' + totalTrialTime + '" type="hidden">');
    $('#data').append('<input name="' + eventLabel + '" class="reactionTime" value="' + reactionTime + '" type="hidden">');
    $('#data').append('<input name="' + eventLabel + '" class="trialType" value="' + decisionType + '" type="hidden">');
    $('#data').append('<input name="' + eventLabel + '" class="berryCount" value="' + berryCount + '" type="hidden">');
    console.log($("#data"));
}

// $('#startTrial').click(showFirstTrial);
function showFirstTrial() {
    $('body').css('background-color', 'AntiqueWhite')
    $('.startDiv').hide();
    $('#trialDiv').show();
    //draw the bushes
    for (i = 0; i < 12; i++) {
        $('#bush' + i).css("bottom", 7 + (travelTime / speed * i) + "%");
    }
    //draw the explore square
    var ht = $('#bush0').height();
    $('#explore').css({
        'height': ht + 'px',
        'width': ht + 'px'
    })
    //draw the fixation square
    $('#fixation').css({
        'height': ht - 10 + 'px',
        'width': ht - 10 + 'px'
    })
    //draw the bush output
    var bot = $('#bush0').css("bottom");
    $('#bushOutput').css({
        'bottom': bot
    })

    //begin the timer
    setTimeout(function() {
        //append the total number of berries collected
        //$('#data').append('<input name=block1totalBerries ' + 'class="totalBerries " value=' + culmBerries + ' type="hidden">');

        $('#finishDiv').prepend('<p>You collected <b>' + culmBerries.toFixed(2) + '</b> berries this round!');
        $('#trialDiv').hide();
        $('#finishDiv').show();
    }, totalTime1 * 1000);
}



// Code related to task:

// Standard Normal variate using Box-Muller transform
// returns mean = 0, var = 1
function randn_bm(sd = 1) {
    var u = 1 - Math.random(); // Subtraction to flip [0, 1) to (0, 1].
    var v = 1 - Math.random();
    return Math.sqrt( -2.0 * Math.log( u ) ) * Math.cos( 2.0 * Math.PI * v ) * sd;
}



var bushOnLeft = true;

function moveBushes() {
    selectTime = false;
    $('#explore').hide();
    $('#fixation').hide();
    bushOnLeft = !bushOnLeft;

    //append new reaction time data
    var rt = new Date() - startTrialTime;
    var totalTrialTime = new Date() - startInitiateTime;

    // addObservation(blockNumber + "_p" + (currBush + 1) + "n" + trialPerBush, totalTrialTime, rt, "l", "")

    //$('#data').append('<input name=' + blockNumber + 'rt_bush' + (currBush + 1) + "round" + trialPerBush + ' class="reactionTime" value=' + rt + ' type="hidden">');
    //$('#data').append('<input name=' + blockNumber + 'totalTrialTime_bush' + (currBush + 1) + "round" + trialPerBush + ' class="totalTrialTime" value=' + totalTrialTime + ' type="hidden">');
    //$('#data').append('<input name=' + blockNumber + 'decision_bush' + (currBush + 1) + "round" + trialPerBush + ' class="trialType" value=explore' + ' type="hidden">');

    //move the bushes
    $('.bush').animate( {
        bottom: "-=" + (travelTime / speed) + "%"
    }, travelTime, "linear", function() {
        //if bush leaves screen, push it to top of screen
        if ($(this).css('bottom') < "0px") {
            $(this).css('bottom', 7 + (travelTime / speed * 11) + '%');
            //redraw the explore square and bushOutput, contingent on bushOnLeft
            if (bushOnLeft) {
                $('#explore').css({
                    'right': 'auto',
                    'left': '63%'
                });
                $('#bushOutput').css({
                    'right': 'auto',
                    'left': '15%'
                })
            } else {
                $('#explore').css({
                    'left': 'auto',
                    'right': '63%'
                });
                $('#bushOutput').css({
                    'left': 'auto',
                    'right': '15%'
                })
            }
            $('#fixationBorder').css('stroke', 'yellowgreen');
            $('#focus').css('height', '0%');

            $('#explore').show();
            $('#fixation').show();
            // start a new timer that will track when subject enters box
            startInitiateTime = new Date();
            //related to bushes
            trialPerBush = 1;
            //berries = Math.round(+(initBerries + randn_bm(randStdDev)).toFixed(2));
            berries = +(initBerries + randn_bm(randStdDev)).toFixed(2);
            currBush++;
        }
    });

}

// event listeners


var selectTime = false;
var currBush = 0;
var trialPerBush = 1;
//var berries = Math.round(+(initBerries + randn_bm(randStdDev)).toFixed(2));
var berries = +(initBerries + randn_bm(randStdDev)).toFixed(2);
var startTrialTime;
var startInitiateTime = new Date();
var culmBerries = 0;

$('#fixation').hover(
    function() {   //function while hovering
    if (!selectTime) {
        $('#fixationBorder').css('stroke', 'green');
        myTimer = setTimeout(function () {
            $('#focus').css('height', '100%');
            selectTime = true;
            //begin timer
            startTrialTime = new Date();
        }, fixationTime);
    }
}, function() {    //function when left
    if (!selectTime) {
        $('#fixationBorder').css('stroke', 'yellowgreen');
        clearTimeout(myTimer);
    }
})

$('.bush').mouseenter(function() {
    //if you mouseover the bush that is lined up
    if ( $(this).attr('id') == ("bush" + (currBush % 12)) && selectTime) {
        selectTime = false;
        var rt = new Date() - startTrialTime;
        var totalTrialTime = new Date() - startInitiateTime;
        $('#fixation').hide();
        //append new data
        // addObservation(blockNumber + "_p" + (currBush + 1) + "n" + trialPerBush, totalTrialTime, rt, "s", berries)

        //$('#data').append('<input name=' + blockNumber + 'berries_bush' + (currBush + 1) + "round" + trialPerBush + ' class="berryCount" value=' + berries + ' type="hidden">');
        //$('#data').append('<input name=' + blockNumber + 'rt_bush' + (currBush + 1) + "round" + trialPerBush + ' class="reactionTime" value=' + rt + ' type="hidden">');
        //$('#data').append('<input name=' + blockNumber + 'totalTrialTime_bush' + (currBush + 1) + "round" + trialPerBush + ' class="totalTrialTime" value=' + totalTrialTime + ' type="hidden">');
        //$('#data').append('<input name=' + blockNumber + 'decision_bush' + (currBush + 1) + "round" + trialPerBush + ' class="trialType" value=exploit' + ' type="hidden">');

        culmBerries += berries;
        $('#bushOutput').html('+' + berries);
        $('#bushOutput').delay(500).show(0);
        //display bush output for some time, reset for next round
        setTimeout(function() {
            $('#bushOutput').hide();
            $('#fixationBorder').css('stroke', 'yellowgreen');
            $('#focus').css('height', '0%');
            //decrement berries, but only if positive
            //berries -= Math.round((+(rateOfDec + randn_bm(randStdDev)).toFixed(2)));
            berries -= +(rateOfDec + randn_bm(randStdDev)).toFixed(2);
            berries = +(berries.toFixed(2));
            if (berries < 0) {
                berries = 0;
            }

            trialPerBush++;
            $('#fixation').show();
        }, holdingTime);
    }
})

$('#explore').mouseenter(function() {
    if (selectTime) {
        moveBushes();
    }
})


$('#startTrial').click(function() {
    $('body').css('background-color', 'AntiqueWhite')
    $('.startDiv').hide();
    $('.bush').stop();
    //set event variables to initial values
    selectTime = false;
    currBush = 0;
    trialPerBush = 1;
    //berries = Math.round(+(initBerries + randn_bm(randStdDev2)).toFixed(2));
    berries = +(initBerries2 - randn_bm(randStdDev2)).toFixed(2);
    startTrialTime;
    startInitiateTime = new Date();
    culmBerries = 0;
    bushOnLeft = true;
    $('#fixationBorder').css('stroke', 'yellowgreen');
    $('#focus').css('height', '0%');

    //set parameters to new parameters
    travelTime = travelTime2;
    initBerries = initBerries2;
    rateOfDec = rateOfDec2;
    blockNumber = "b2"

    //redraw the bushes
    for (i = 0; i < 12; i++) {
        $('#bush' + i).css("bottom", 7 + (travelTime / speed * i) + "%");
    }
    //reposition explore square
    $('#explore').css('left', '63%');
    //reposition bushOutput
    $('#bushOutput').css('left', '15%');

    $('#breakDiv').hide();
    $('#trialDiv').show();
    $('#explore').show();
    $('#fixation').show();

    //begin the timer
    setTimeout(function () {
        //append the total number of berries collected
        //$('#data').append('<input name=Block2totalBerries ' + 'class="totalBerries " value=' + culmBerries + ' type="hidden">');

        $('#trialDiv').hide();
        $('#finishDiv').append('<p>You collected <b>' + culmBerries.toFixed(2) + '</b> berries this round!');
        //$('#finishDiv').append('<p>To complete the task and receive your reward, please complete the following survey by following the link below.</p>');
        //$('#finishDiv').append('<p><strong>Make sure to leave this window open as you complete the survey. </strong></p>');
        //$('#finishDiv').append('<p>When you are finished, you will return to this page to paste the code into the box.</p>');
        //$('#finishDiv').append('<div class="row" id="workContent"><div class="col-xs-12 col-md-6 col-md-offset-3"><!-- Content for Worker --><table class="table table-condensed table-bordered"><colgroup><col class="col-xs-4 col-md-4" /><col class="col-xs-8 col-md-8" /></colgroup><tbody><tr><td><label>Survey link:</label></td><td><a class="dont-break-out" href="https://upenn.co1.qualtrics.com/jfe/form/SV_cNiPOAgJOvt8grr" target="_blank">https://____</a></td></tr></tbody></table><!-- End Content for Worker --><!-- Input from Worker --><div class="form-group"><label for="surveycode">Provide the survey code here:</label> <input class="form-control" id="surveycode" name="surveycode" placeholder="e.g. 123456" required="" type="text" /></div><!-- End input from Worker --></div>')
        $('#finishDiv').append('<p>Trial is over. We will now move to the game</p>');
        $('#finishDiv').show();
        $('#submitButton').show();
    }, totalTime2 * 1000);

});


</script>


<!-- ***************************************************************************************************************************************** -->
<div id="submitButton" style="position:inherit;margin:0 auto;width:500px">
    <!-- <div class="form-group">
        <label for="wblid">Please enter your MTurk ID/ WBL ID/ Student Roll No. here:</label> 
        <input class="form-control" id="wblid" name="wblid" placeholder="" required="" type="text" />
        <input type="hidden" name="bucket_key" value="mturk"/>
    </div> -->
<p id="line13">
<a href="berry_collection_game_original.html">Move to next game</a></p>
</div>
<!-- </form> -->
<!--  -->
